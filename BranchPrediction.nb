(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[      9385,        227]
NotebookOptionsPosition[      7894,        201]
NotebookOutlinePosition[      8226,        216]
CellTagsIndexPosition[      8183,        213]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.737181625064831*^9, 3.737181639588257*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"b15aded6-ea9f-4374-9010-3902e161775b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dataset", "=", 
   RowBox[{"Import", "[", "\"\<branchstatelist.xml\>\"", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.737181611809001*^9, 3.737181648754077*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"df8d723f-fe3e-440c-9c69-e3b8ab616b86"],

Cell[BoxData[
 RowBox[{"dataset", "//", "TableView"}]], "Input",
 CellChangeTimes->{{3.737185062464822*^9, 3.7371850667366447`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"3d8f909d-12fc-4984-bdfc-4079f7b20509"],

Cell[BoxData[
 RowBox[{
  RowBox[{"jumpsDataset", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"dataset", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "+", 
         RowBox[{"#", "[", 
          RowBox[{"[", "4", "]"}], "]"}]}], ">", "0"}], ")"}], "&"}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.737184030514155*^9, 3.737184112297986*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"3ae987f1-b5ec-4e78-9067-4edfb96e074f"],

Cell[BoxData[
 RowBox[{"jumpsDataset", "//", "TableView"}]], "Input",
 CellChangeTimes->{{3.737181656310032*^9, 3.737181660703526*^9}, {
   3.73718172853703*^9, 3.737181738348159*^9}, {3.7371840874036837`*^9, 
   3.737184097397223*^9}, 3.737185316062776*^9},
 CellLabel->"In[5]:=",ExpressionUUID->"b857f278-1a72-4004-8e97-95a5d9dbce65"],

Cell[BoxData[
 RowBox[{
  RowBox[{"historyLen", "=", "10"}], ";"}]], "Input",
 CellChangeTimes->{{3.7371843051775208`*^9, 3.737184309251334*^9}, {
  3.737186263543645*^9, 3.737186263738161*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"40a8cd36-39c3-4077-ba57-a2f87ad8f51a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trainingData", "=", 
   RowBox[{
    RowBox[{"Reap", "[", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", 
        RowBox[{"historyLen", "+", "1"}]}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "jumpsDataset", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Sow", "[", 
        RowBox[{
         RowBox[{"jumpsDataset", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{
             RowBox[{"i", "-", "historyLen"}], ";;", 
             RowBox[{"i", "-", "1"}]}], ",", "3"}], "]"}], "]"}], "\[Rule]", 
         RowBox[{"jumpsDataset", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "]"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.737186641909012*^9, 3.737186643988183*^9}, {
  3.737186735240718*^9, 3.7371867851158133`*^9}, {3.737186822369388*^9, 
  3.737186837032312*^9}, {3.737186885630019*^9, 3.73718692276388*^9}, {
  3.737187029991931*^9, 3.7371870591346693`*^9}, {3.737187103559827*^9, 
  3.737187114943893*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"3613f5d5-affd-4741-b0f1-9f7fe0a64cc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"classes", "=", 
   RowBox[{"{", 
    RowBox[{"0", ",", "1"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.737127139846114*^9, 3.737127145961792*^9}, {
  3.7371276269380827`*^9, 3.7371276303958397`*^9}, {3.737186850212203*^9, 
  3.737186851225754*^9}},
 CellLabel->"In[69]:=",ExpressionUUID->"87eb8a0b-795e-4ad1-bc0a-e74417801b75"],

Cell[BoxData[
 RowBox[{"bpNet", "=", 
  RowBox[{"NetChain", "[", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"LinearLayer", "[", "10", "]"}], ",", "Ramp", ",", 
     RowBox[{"LinearLayer", "[", "]"}], ",", 
     RowBox[{"SoftmaxLayer", "[", "]"}]}], "}"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"\"\<Output\>\"", "\[Rule]", 
      RowBox[{"NetDecoder", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<Class\>\"", ",", "classes"}], "}"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Input\>\"", "\[Rule]", 
      RowBox[{"NetEncoder", "[", 
       RowBox[{"{", 
        RowBox[{"\"\<Class\>\"", ",", "classes"}], "}"}], "]"}]}]}], "*)"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7371270689396057`*^9, 3.737127079146886*^9}, {
   3.737127199714521*^9, 3.737127263452217*^9}, {3.7371273210933323`*^9, 
   3.737127368637388*^9}, {3.737127407365576*^9, 3.737127426345086*^9}, {
   3.7371274571466084`*^9, 3.7371274615959473`*^9}, {3.7371276066342497`*^9, 
   3.737127611132967*^9}, {3.737127742466082*^9, 3.737127745811977*^9}, {
   3.7371279696334267`*^9, 3.7371279714266863`*^9}, 3.737128098233246*^9, {
   3.737187053228286*^9, 3.737187054277268*^9}, {3.737187467868332*^9, 
   3.7371874714118423`*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"02632639-e007-442f-8640-168083f8e3bc"],

Cell[BoxData[
 RowBox[{"trainedNet", "=", 
  RowBox[{"NetTrain", "[", 
   RowBox[{"bpNet", ",", "trainingData"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.737127080538436*^9, 3.73712709469744*^9}, 
   3.737127899964946*^9, {3.7371873452065077`*^9, 3.737187345638286*^9}},
 CellLabel->"In[81]:=",ExpressionUUID->"47c416ef-6ece-4770-b616-d8ce32197379"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testData", "=", 
   RowBox[{
    RowBox[{"Reap", "[", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", 
        RowBox[{"3000", "+", "1"}]}], ",", 
       RowBox[{"i", "\[LessEqual]", 
        RowBox[{"Length", "[", "jumpsDataset", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Sow", "[", 
        RowBox[{
         RowBox[{"jumpsDataset", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{
             RowBox[{"i", "-", "historyLen"}], ";;", 
             RowBox[{"i", "-", "1"}]}], ",", "3"}], "]"}], "]"}], "\[Rule]", 
         RowBox[{"jumpsDataset", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "]"}]}], "]"}], 
     "\[IndentingNewLine]", "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.737187152938199*^9, 3.737187171170817*^9}},
 CellLabel->"In[82]:=",ExpressionUUID->"e2f4df6d-a68b-4cb0-971e-6b8c647e8de1"],

Cell[BoxData[
 RowBox[{"cm", "=", 
  RowBox[{"ClassifierMeasurements", "[", 
   RowBox[{"trainedNet", ",", "testData"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.737180057467279*^9, 3.737180061673421*^9}, {
  3.7371801011310663`*^9, 3.737180103067402*^9}, {3.7371802067941628`*^9, 
  3.737180208121266*^9}, {3.7371868743609858`*^9, 3.73718687478857*^9}, {
  3.737187347609149*^9, 3.737187347803726*^9}},
 CellLabel->"In[83]:=",ExpressionUUID->"9a7554fc-dc23-4ed2-be73-2a17706beccd"],

Cell[BoxData[
 RowBox[{"cm", "[", "\"\<Accuracy\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.737187275845132*^9, 3.737187278357882*^9}},
 CellLabel->"In[84]:=",ExpressionUUID->"ee3a6fb4-bea3-4813-917a-a78aa637999f"],

Cell[BoxData[
 RowBox[{"cm", "[", "\"\<ConfusionMatrixPlot\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.7371872925916452`*^9, 3.73718729259313*^9}},
 CellLabel->"In[85]:=",ExpressionUUID->"b971487f-c0d9-4dd4-9cda-d3d4d1390581"]
},
WindowSize->{682, 721},
WindowMargins->{{2, Automatic}, {1, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 7, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 267, 5, 31, "Input",ExpressionUUID->"b15aded6-ea9f-4374-9010-3902e161775b"],
Cell[831, 27, 280, 6, 31, "Input",ExpressionUUID->"df8d723f-fe3e-440c-9c69-e3b8ab616b86"],
Cell[1114, 35, 210, 3, 31, "Input",ExpressionUUID->"3d8f909d-12fc-4984-bdfc-4079f7b20509"],
Cell[1327, 40, 529, 15, 31, "Input",ExpressionUUID->"3ae987f1-b5ec-4e78-9067-4edfb96e074f"],
Cell[1859, 57, 336, 5, 31, "Input",ExpressionUUID->"b857f278-1a72-4004-8e97-95a5d9dbce65"],
Cell[2198, 64, 273, 5, 31, "Input",ExpressionUUID->"40a8cd36-39c3-4077-ba57-a2f87ad8f51a"],
Cell[2474, 71, 1314, 31, 124, "Input",ExpressionUUID->"3613f5d5-affd-4741-b0f1-9f7fe0a64cc2"],
Cell[3791, 104, 369, 8, 31, "Input",ExpressionUUID->"87eb8a0b-795e-4ad1-bc0a-e74417801b75"],
Cell[4163, 114, 1379, 28, 124, "Input",ExpressionUUID->"02632639-e007-442f-8640-168083f8e3bc"],
Cell[5545, 144, 350, 6, 31, "Input",ExpressionUUID->"47c416ef-6ece-4770-b616-d8ce32197379"],
Cell[5898, 152, 1059, 27, 124, "Input",ExpressionUUID->"e2f4df6d-a68b-4cb0-971e-6b8c647e8de1"],
Cell[6960, 181, 482, 8, 31, "Input",ExpressionUUID->"9a7554fc-dc23-4ed2-be73-2a17706beccd"],
Cell[7445, 191, 215, 3, 31, "Input",ExpressionUUID->"ee3a6fb4-bea3-4813-917a-a78aa637999f"],
Cell[7663, 196, 227, 3, 31, "Input",ExpressionUUID->"b971487f-c0d9-4dd4-9cda-d3d4d1390581"]
}
]
*)

